<ng-container>
  <div id="profile-short-description" *ngIf="profile.short_description">
    <div class="facts-title">
      <div>Kurzbeschreibung</div>
    </div>
    <p class="facts-body" markdown [data]="profile.short_description"></p>
  </div>
  <solid-core-media
    *ngIf="profile.mediaObjects.length > 0; else noImage"
    id="profile-media-container"
    (swipeleft)="swipe(ImageSelected, $event.type)"
    (swiperight)="swipe(ImageSelected, $event.type)"
    [mediaObject]="profile.mediaObjects[ImageSelected]"
    [name]="profile.name"
    [hasDialog]="hasDialog"
    [hasDescription]="hasDescription"
    [hasDescriptionToggle]="hasDescriptionToggle"
    (NextDialogEmitter)="handleNextDialogEvent()"
    (PrevDialogEmitter)="handlePrevDialogEvent()"
    [hasNavigationInDialog]="MediaObjectsOnlyImages.length > 1"
  ></solid-core-media>
  <ng-template #noImage>
    <div class="no-img-container" id="profile-media-container">
      <img class="no-img" src="assets/profile/no_image.svg" />
    </div>
  </ng-template>
  <div class="scroll-container">
    <div
      *ngIf="profile.mediaObjects.length > 1"
      class="img-toolbar"
      #thumbnails
    >
      <ng-container
        *ngFor="let mediaObject of profile.mediaObjects; let i = index"
      >
        <img
          *ngIf="mediaObject.mediaType === 'image'"
          (click)="onImageSelect(i)"
          [class.not-selected]="ImageSelected !== i"
          [src]="mediaObject.getRawImage('thumbnail')"
          [alt]="mediaObject.alt"
        />
        <img
          *ngIf="mediaObject.mediaType === 'video'"
          (click)="onImageSelect(i)"
          [class.not-selected]="ImageSelected !== i"
          [src]="'assets/profile/video.svg'"
          [alt]="mediaObject.alt"
        />
        <img
          *ngIf="mediaObject.mediaType === 'audio'"
          (click)="onImageSelect(i)"
          [class.not-selected]="ImageSelected !== i"
          [src]="'assets/profile/audio.svg'"
          [alt]="mediaObject.alt"
        />
      </ng-container>
    </div>
  </div>
</ng-container>

<!-- Load definitions from OpenAPI 2.0 -->
<ng-container
  *ngIf="$ProfileDefinition_Swagger | async as profileDefinitions_swagger"
>
  <mat-accordion
    id="profile-detail-info"
    *ngIf="profileDefinitions_swagger.length !== 0"
    [multi]="false"
    displayMode="flat"
    #expansion
  >
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Allgemein</mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngFor="let property of profileDefinitions_swagger">
        <ng-container *ngIf="property.type !== PropertyTypes.Group">
          <ng-container
            *ngTemplateOutlet="
              propertyTemplate;
              context: { profile_obj: profile, property: property }
            "
          ></ng-container>
        </ng-container>
      </ng-container>
    </mat-expansion-panel>
    <ng-container *ngFor="let property of profileDefinitions_swagger">
      <mat-expansion-panel
        *ngIf="
          property.type === PropertyTypes.Group &&
          (property.required || profile[property.key])
        "
      >
        <mat-expansion-panel-header>
          <mat-panel-title>{{ property.title }}</mat-panel-title>
        </mat-expansion-panel-header>
        <ng-container *ngFor="let childProperty of property.properties">
          <ng-container
            *ngTemplateOutlet="
              propertyTemplate;
              context: {
                profile_obj: profile[property.key],
                property: childProperty
              }
            "
          ></ng-container>
        </ng-container>
      </mat-expansion-panel>
    </ng-container>
  </mat-accordion>
</ng-container>
<ng-template
  #propertyTemplate
  let-profile_obj="profile_obj"
  let-property="property"
>
  <ng-container
    *ngIf="shouldDisplayProperty(property, profile_obj)"
    [ngSwitch]="property.type"
  >
    <p class="heading">{{ property.title }}</p>
    <ng-container *ngSwitchCase="PropertyTypes.String">
      <p
        *ngIf="
          !(profile_obj[property.key].indexOf('http') === 0);
          else httpString
        "
      >
        {{ profile_obj[property.key] }}
      </p>
      <ng-template #httpString>
        <p>
          <a [href]="profile_obj[property.key]" target="_blank">
            {{ profile_obj[property.key] }}
          </a>
        </p>
      </ng-template>
    </ng-container>
    <p *ngSwitchCase="PropertyTypes.Integer">
      {{ profile_obj[property.key] }}
    </p>
    <p *ngSwitchCase="PropertyTypes.Boolean">
      {{ profile_obj[property.key] }}
    </p>
    <p
      *ngSwitchCase="PropertyTypes.Mdstring"
      markdown
      [data]="profile_obj[property.key]"
    ></p>
    <ng-container *ngSwitchCase="PropertyTypes.Colstring">
      <p
        *ngIf="profile_obj[property.key].indexOf('#') === 0; else notColString"
        id="normal_color"
        [style.background-color]="profile_obj[property.key]"
      ></p>
      <ng-template #notColString>
        <p>{{ profile_obj[property.key] }}</p>
      </ng-template>
    </ng-container>
    <ng-container *ngSwitchCase="PropertyTypes.List">
      <p *ngFor="let val of profile_obj[property.key]">{{ val }}</p>
    </ng-container>
  </ng-container>
</ng-template>

<!-- Load definitions from OpenAPI 3.0 -->
<ng-container *ngIf="$ProfileDefinition | async as profileDefinitions">
  <mat-accordion
    id="profile-detail-info"
    *ngIf="profileDefinitions.length !== 0"
    [multi]="false"
    displayMode="flat"
    #expansion
  >
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Allgemein </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngFor="let property of profileDefinitions">
        <ng-container *ngIf="property.type !== PropertyTypes.Group">
          <ng-container
            *ngTemplateOutlet="
              propertyTemplate;
              context: { profile_obj: profile, property: property }
            "
          ></ng-container>
        </ng-container>
      </ng-container>
    </mat-expansion-panel>
    <ng-container *ngFor="let property of profileDefinitions">
      <mat-expansion-panel
        *ngIf="
          property.type === PropertyTypes.Group &&
          (property.required || profile[property.key])
        "
      >
        <mat-expansion-panel-header>
          <mat-panel-title>{{ property.title }}</mat-panel-title>
        </mat-expansion-panel-header>
        <ng-container *ngFor="let childProperty of property.properties">
          <ng-container
            *ngTemplateOutlet="
              propertyTemplate;
              context: {
                profile_obj: profile[property.key],
                property: childProperty
              }
            "
          ></ng-container>
        </ng-container>
      </mat-expansion-panel>
    </ng-container>
  </mat-accordion>
</ng-container>
<ng-template
  #propertyTemplate
  let-profile_obj="profile_obj"
  let-property="property"
>
  <ng-container
    *ngIf="shouldDisplayProperty(property, profile_obj)"
    [ngSwitch]="property.type"
  >
    <p class="heading">{{ property.title }}</p>
    <ng-container *ngSwitchCase="PropertyTypes.String">
      <p
        *ngIf="
          !(profile_obj[property.key].indexOf('http') === 0);
          else httpString
        "
      >
        {{ profile_obj[property.key] }}
      </p>
      <ng-template #httpString>
        <p>
          <a [href]="profile_obj[property.key]" target="_blank">
            {{ profile_obj[property.key] }}
          </a>
        </p>
      </ng-template>
    </ng-container>
    <p *ngSwitchCase="PropertyTypes.Integer">
      {{ profile_obj[property.key] }}
    </p>
    <p *ngSwitchCase="PropertyTypes.Boolean">
      {{ profile_obj[property.key] }}
    </p>
    <p
      *ngSwitchCase="PropertyTypes.Mdstring"
      markdown
      [data]="profile_obj[property.key]"
    ></p>
    <ng-container *ngSwitchCase="PropertyTypes.Colstring">
      <p
        *ngIf="profile_obj[property.key].indexOf('#') === 0; else notColString"
        id="normal_color"
        [style.background-color]="profile_obj[property.key]"
      ></p>
      <ng-template #notColString>
        <p>{{ profile_obj[property.key] }}</p>
      </ng-template>
    </ng-container>
    <ng-container *ngSwitchCase="PropertyTypes.List">
      <p *ngFor="let val of profile_obj[property.key]">{{ val }}</p>
    </ng-container>
  </ng-container>
</ng-template>
