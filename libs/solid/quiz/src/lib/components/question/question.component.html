<ng-container *ngIf="question && QuizSession | async as quizSession">
  <div class="toolbar-container" #toolbar>
    <div class="toolbar">
      <button mat-icon-button class="button-back" (click)="onBackBtnClick()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <button mat-icon-button class="button-close" (click)="onCloseClick()">
        <mat-icon>bar_chart</mat-icon>
      </button>
      <div class="step-actions">
        <div class="title">
          <h2>
            Fragen {{ quizSession.currentQuestion + 1 }} von
            {{ quizSession.questions.length }}
          </h2>
          <span>{{ question.tags.join(' ') }}</span>
        </div>
      </div>
    </div>
    <mat-progress-bar
      mode="determinate"
      [value]="quizSession.progress"
    ></mat-progress-bar>
  </div>
  <mat-card>
    <mat-card-header>
      <mat-card-subtitle markdown [data]="question.text"></mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="question.images.length > 0" class="image-container">
        <button
          mat-icon-button
          class="button-before"
          color="accent"
          *ngIf="question.images.length > 1"
          (click)="
            swipe(ImageIndex, question.images.length, SWIPE_ACTION.RIGHT)
          "
        >
          <mat-icon aria-label="Vorheriger Schritt">navigate_before</mat-icon>
        </button>
        <solid-core-media
          (swiperight)="swipe(ImageIndex, question.images.length, $event.type)"
          (swipeleft)="swipe(ImageIndex, question.images.length, $event.type)"
          [mediaObject]="question.images[ImageIndex]"
          [hasDialog]="true"
          [hasAudio]="false"
          [hasAttributions]="true"
        ></solid-core-media>
        <button
          class="button-next"
          color="accent"
          mat-icon-button
          *ngIf="question.images.length > 1"
          (click)="swipe(ImageIndex, question.images.length, SWIPE_ACTION.LEFT)"
        >
          <mat-icon aria-label="Nächster Schritt">navigate_next</mat-icon>
        </button>
      </div>
      <ng-container [ngSwitch]="question.type">
        <mat-card-content
          *ngSwitchCase="QuestionTypes.SingleChoice"
          class="single-choice"
        >
          <solid-quiz-single-choice-question
            [SelectedAnswers]="SelectedAnswers"
            [ShowAnswers]="ShowAnswers"
            [question]="question"
          >
          </solid-quiz-single-choice-question>
        </mat-card-content>
        <mat-card-content
          *ngSwitchCase="QuestionTypes.MultipleChoice"
          class="multiple-choice"
        >
          <mat-checkbox
            (change)="onSelectChange($event, answer)"
            *ngFor="let answer of question.answers; trackBy: trackByFn"
            [checked]="isAnswerCorrect(answer)"
            [class.correctselected]="
              isAnswerCorrect(answer) && SelectedAnswers.includes(answer.id)
            "
            [class.incorrectselected]="
              isAnswerIncorrect(answer) && SelectedAnswers.includes(answer.id)
            "
            [class.correctunselected]="
              isAnswerCorrect(answer) && !SelectedAnswers.includes(answer.id)
            "
            [class.incorrectunselected]="
              isAnswerIncorrect(answer) && !SelectedAnswers.includes(answer.id)
            "
            [disabled]="ShowAnswers"
            [indeterminate]="isAnswerIncorrect(answer)"
            color="primary"
          >
            <span
              markdown
              [data]="answer.text"
              [class.selected]="
                ShowAnswers && SelectedAnswers.includes(answer.id)
              "
            ></span>
            <span
              *ngIf="ShowAnswers && SelectedAnswers.includes(answer.id)"
              [data]="
                answer.correct
                  ? answer.feedback_correct
                  : answer.feedback_incorrect
              "
              markdown
              class="feedback"
            ></span>
          </mat-checkbox>
        </mat-card-content>
        <mat-card-actions>
          <button
            (click)="onShowAnswersClick()"
            *ngIf="!ShowAnswers"
            color="primary"
            mat-raised-button
            class="ShowAnswerBtn"
          >
            Lösungen anzeigen
          </button>
          <button
            (click)="onNextQuestionClick()"
            *ngIf="ShowAnswers"
            color="primary"
            mat-raised-button
          >
            {{ Correct ? 'Richtig,' : ' Falsch,' }} nächste Frage
          </button>
        </mat-card-actions>
      </ng-container>
    </mat-card-content>
  </mat-card>
  <ng-template #backPopup>
    <div class="close-popup">
      <button mat-icon-button mat-dialog-close class="popUpCloseBtn">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <mat-dialog-content>
      <p>Do you really want to close this Quiz-session?</p>
    </mat-dialog-content>
    <mat-dialog-actions>
      <button class="cancelBtn" mat-button mat-dialog-close cdkFocusInitial>
        Cancel
      </button>
      <button
        class="backBtn"
        mat-button
        [mat-dialog-close]="true"
        (click)="onBackToStart()"
      >
        Yes
      </button>
    </mat-dialog-actions>
  </ng-template>
</ng-container>
